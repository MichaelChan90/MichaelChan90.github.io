<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Michael Chan"><meta name="copyright" content="Michael Chan"><meta name="generator" content="Hexo 6.3.0"><meta name="theme" content="hexo-theme-yun"><title>Centos7安装MySQL | MichaelChan Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="mask-icon" href="/favicon.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"michaelchan90.github.io","root":"/","title":"星无尘的博客","version":"1.10.9","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=UA-164931119-1"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-164931119-1');
}</script><script data-ad-client="ca-pub-9775647830683925" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="[toc] 下载安装系统：Centos7 MySQL 5.7下载地址：https:&#x2F;&#x2F;cdn.mysql.com&#x2F;archives&#x2F;mysql-5.7&#x2F;mysql-5.7.40-1.el7.x86_64.rpm-bundle.tar MySQL 8.0下载地址：https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.32-1.el7.x86_64.">
<meta property="og:type" content="article">
<meta property="og:title" content="Centos7安装MySQL">
<meta property="og:url" content="http://michaelchan90.github.io/2023/02/10/Centos7%E5%AE%89%E8%A3%85MySQL/index.html">
<meta property="og:site_name" content="MichaelChan Blog">
<meta property="og:description" content="[toc] 下载安装系统：Centos7 MySQL 5.7下载地址：https:&#x2F;&#x2F;cdn.mysql.com&#x2F;archives&#x2F;mysql-5.7&#x2F;mysql-5.7.40-1.el7.x86_64.rpm-bundle.tar MySQL 8.0下载地址：https:&#x2F;&#x2F;cdn.mysql.com&#x2F;&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.32-1.el7.x86_64.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-02-10T09:46:44.000Z">
<meta property="article:modified_time" content="2023-03-28T03:01:15.975Z">
<meta property="article:author" content="Michael Chan">
<meta name="twitter:card" content="summary"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="Michael Chan"><img width="96" loading="lazy" src="https://cdn.jsdelivr.net/gh/michaelchan90/blog-imgbed/img/go.jpg" alt="Michael Chan"><span class="site-author-status" title="又是新的一天">🤔</span></a><div class="site-author-name"><a href="/about/">Michael Chan</a></div><a class="site-name" href="/about/site.html">MichaelChan Blog</a><sub class="site-subtitle">星无尘</sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="主页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档(archives)"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">22</span></a></div><div class="site-state-item"><a href="/categories/" title="分类(categories)"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">20</span></a></div><div class="site-state-item"><a href="/tags/" title="标签(tags)"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">3</span></a></div></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/michaelchan90" title="GitHub" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:michaelchan90@outlook.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E6%A3%80%E6%9F%A5"><span class="toc-number">2.1.</span> <span class="toc-text">预检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rpm%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">rpm安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">4.</span> <span class="toc-text">问题排查</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99Host-name-could-not-be-resolved%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-number">4.1.</span> <span class="toc-text">mysql 启动报错Host name could not be resolved解决办法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E9%85%8D%E7%BD%AE%E5%AE%8C%E6%88%90%E5%90%8E%EF%BC%8C%E5%90%AF%E5%8A%A8mysql%E6%9C%8D%E5%8A%A1%E5%90%8E%EF%BC%8C%E8%BF%9E%E6%8E%A5mysql%E6%8A%A5%E9%94%99%EF%BC%9AERROR-2002-HY000-Can%E2%80%99t-connect-to-local-MySQL-server-through-socket-%E2%80%98-x2F-var-x2F-lib-x2F-mysql-x2F-mysql-sock%E2%80%99-2"><span class="toc-number">4.2.</span> <span class="toc-text">mysql配置完成后，启动mysql服务后，连接mysql报错：ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock’ (2)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%8C%85"><span class="toc-number">4.3.</span> <span class="toc-text">缺失包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mysql-community-libs-compat%E6%97%B6%E6%8A%A5%E9%94%99%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">4.3.1.</span> <span class="toc-text">安装mysql-community-libs-compat时报错如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mysql-community-client%E6%97%B6%E9%94%99%E6%8A%A5"><span class="toc-number">4.3.2.</span> <span class="toc-text">安装mysql-community-client时错报</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mysql-community-server%E6%8A%A5%E9%94%99"><span class="toc-number">4.4.</span> <span class="toc-text">安装mysql-community-server报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95%E5%90%8E%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99"><span class="toc-number">4.5.</span> <span class="toc-text">修改数据目录后启动报错</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://michaelchan90.github.io/2023/02/10/Centos7%E5%AE%89%E8%A3%85MySQL/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Michael Chan"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="MichaelChan Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Centos7安装MySQL</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2023-02-10 17:46:44" itemprop="dateCreated datePublished" datetime="2023-02-10T17:46:44+08:00">2023-02-10</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2023-03-28 11:01:15" itemprop="dateModified" datetime="2023-03-28T11:01:15+08:00">2023-03-28</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">8.8k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">34m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">数据库</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">MySQL</span></a></span></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p>[toc]</p>
<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p>安装系统：Centos7</p>
<p>MySQL 5.7下载地址：<a target="_blank" rel="noopener" href="https://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.40-1.el7.x86_64.rpm-bundle.tar">https://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.40-1.el7.x86_64.rpm-bundle.tar</a></p>
<p>MySQL 8.0下载地址：<a target="_blank" rel="noopener" href="https://cdn.mysql.com//Downloads/MySQL-8.0/mysql-8.0.32-1.el7.x86_64.rpm-bundle.tar">https://cdn.mysql.com//Downloads/MySQL-8.0/mysql-8.0.32-1.el7.x86_64.rpm-bundle.tar</a></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="预检查"><a href="#预检查" class="headerlink" title="预检查"></a>预检查</h2><p>1、检查系统是否已安装MySQL或者Mariadb，存在则进行卸载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm查看已安装软件</span></span><br><span class="line">rpm -qa|grep mariadb</span><br><span class="line">rpm -qa|grep mysql</span><br><span class="line"><span class="comment"># rpm卸载软件</span></span><br><span class="line">rpm -e --nodeps ******</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum查看已安装软件</span></span><br><span class="line">yum list installed |grep mariadb</span><br><span class="line">yum list installed |grep mysql</span><br><span class="line"><span class="comment"># yum卸载软件</span></span><br><span class="line">yum remove ******</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除etc目录下my.cnf</span></span><br><span class="line"><span class="built_in">rm</span> /etc/my.cnf</span><br></pre></td></tr></table></figure>



<p>2、Centos7创建用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建组mysql</span></span><br><span class="line">groupadd mysql</span><br><span class="line"><span class="comment"># 创建用户mysql</span></span><br><span class="line">useradd -r -g mysql mysql</span><br><span class="line"><span class="comment"># 查看用户</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd</span><br></pre></td></tr></table></figure>

<p>3、解压文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压缩文件</span></span><br><span class="line">tar -xvf mysql-5.7.40-1.el7.x86_64.rpm-bundle.tar</span><br><span class="line"><span class="comment"># 修改解压包下文件夹所属用户组、用户以及权限</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql mysql目录</span><br><span class="line"><span class="built_in">chmod</span> -R 755 mysql目录</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="rpm安装"><a href="#rpm安装" class="headerlink" title="rpm安装"></a>rpm安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按顺序安装以下包</span></span><br><span class="line">rpm -ivh mysql-community-common*</span><br><span class="line">rpm -ivh mysql-community-libs*</span><br><span class="line">rpm -ivh mysql-community-client*</span><br><span class="line">rpm -ivh mysql-community-server*</span><br></pre></td></tr></table></figure>



<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>1、启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动MySQL服务</span></span><br><span class="line">service mysqld start</span><br><span class="line"><span class="comment"># 查看MySQL启动状态</span></span><br><span class="line">service mysqld status</span><br><span class="line"><span class="comment"># 设置MySQL开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld.service</span><br><span class="line"><span class="comment"># 查看MySQL开机启动状态</span></span><br><span class="line">systemctl status mysqld.service</span><br></pre></td></tr></table></figure>



<p>2、修改MySQL root用户密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机生成密码 </span></span><br><span class="line"><span class="built_in">tr</span> -dc   <span class="string">&#x27;A-Za-z0-9!&quot;#$%&amp;&#x27;</span>\<span class="string">&#x27;&#x27;</span>()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~<span class="string">&#x27;   &lt;/dev/urandom | head -c 15; echo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查看初始化密码</span></span><br><span class="line"><span class="string">cat /var/log/mysqld.log|grep password</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 使用初始化密码登录mysql</span></span><br><span class="line"><span class="string">mysql -uroot -p</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 初始修改root用户密码</span></span><br><span class="line"><span class="string">alter user user() identified by &#x27;</span>Hyjz@123<span class="string">&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 修改root可以远程登录</span></span><br><span class="line"><span class="string">use mysql;</span></span><br><span class="line"><span class="string">update user set host = &#x27;</span>%<span class="string">&#x27; where user = &#x27;</span>root<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">FLUSH PRIVILEGES;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查看密码策略（测试环境用于简短的密码）</span></span><br><span class="line"><span class="string">show variables like &#x27;</span>validate_password%<span class="string">&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># ===================密码规则设置====================</span></span><br><span class="line"><span class="string"># 1）、validate_password_length 固定密码的总长度；</span></span><br><span class="line"><span class="string"># 2）、validate_password_dictionary_file 指定密码验证的文件路径；</span></span><br><span class="line"><span class="string"># 3）、validate_password_mixed_case_count 整个密码中至少要包含大/小写字母的总个数；</span></span><br><span class="line"><span class="string"># 4）、validate_password_number_count 整个密码中至少要包含阿拉伯数字的个数；</span></span><br><span class="line"><span class="string"># 5）、validate_password_policy 指定密码的强度验证等级，默认为 MEDIUM；</span></span><br><span class="line"><span class="string">#    关于 validate_password_policy 的取值：</span></span><br><span class="line"><span class="string">#    0/LOW：只验证长度；</span></span><br><span class="line"><span class="string">#    1/MEDIUM：验证长度、数字、大小写、特殊字符；</span></span><br><span class="line"><span class="string">#    2/STRONG：验证长度、数字、大小写、特殊字符、字典文件；</span></span><br><span class="line"><span class="string"># 6）、validate_password_special_char_count 整个密码中至少要包含特殊字符的个数；</span></span><br><span class="line"><span class="string"># ===================密码规则设置====================</span></span><br><span class="line"><span class="string">set global validate_password_policy=LOW;</span></span><br><span class="line"><span class="string">set global validate_password_length=6;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 二次修改root用户密码</span></span><br><span class="line"><span class="string">set password for &#x27;</span>root<span class="string">&#x27;@&#x27;</span>localhost<span class="string">&#x27;=password(&#x27;</span>hyjz@123<span class="string">&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



<p>3、自定义mysql配置文件（&#x2F;etc&#x2F;my.cnf中配置）</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[client]</span></span><br><span class="line"><span class="comment"># MySQL 客户端连接服务器端时使用的端口号，默认为 3306</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">3306</span></span><br><span class="line"><span class="comment"># 套接字文件所在目录(与mysqld,mysql配置一致)</span></span><br><span class="line"><span class="attr">socket</span>=<span class="string">/var/run/mysql/mysql.sock</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqldump]</span></span><br><span class="line"><span class="comment"># 支持较大的数据库转储，导出非常巨大的表时需要此项 。</span></span><br><span class="line"><span class="attr">quick</span></span><br><span class="line"><span class="comment"># 服务所能处理的请求包的最大大小以及服务所能处理的最大的请求大小（当与大的BLOB字段一起工作时相当必要），每个连接独立的大小，大小动态增加。</span></span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="string">16M</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment"># mysqld 程序在启动后将在给定 UNIX/Linux 账户下执行。mysqld 必须从 root 账户启动才能在启动后切换到另一个账户下执行。mysqld_safe 脚本将默认使用 user=mysql 选项来启动 mysqld 程序。</span></span><br><span class="line"><span class="attr">user</span> = <span class="string">mysql</span></span><br><span class="line"><span class="comment"># 指定 MySQL 安装的绝对路径；</span></span><br><span class="line"><span class="attr">basedir</span> = <span class="string">/usr/local/mysql</span></span><br><span class="line"><span class="comment"># 指定 MySQL 数据存放的绝对路径；</span></span><br><span class="line"><span class="attr">datadir</span> = <span class="string">/mydata/mysql/data</span></span><br><span class="line"><span class="comment"># 监听的ip地址</span></span><br><span class="line"><span class="attr">bind-address</span> = <span class="string">0.0.0.0　　</span></span><br><span class="line"><span class="comment"># 服务端口号，默认为 3306</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">3306</span></span><br><span class="line"><span class="comment"># MySQL 服务的唯一编号，每个 MySQL 服务的 id 需唯一。</span></span><br><span class="line"><span class="attr">server-id</span> = <span class="string">1</span></span><br><span class="line"><span class="comment"># socket 文件所在目录</span></span><br><span class="line"><span class="attr">socket</span>=<span class="string">/var/run/mysql/mysql.sock</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 数据库默认字符集，主流字符集支持一些特殊表情符号（特殊表情符占用 4 个字节）</span></span><br><span class="line"><span class="attr">character-set-server</span> = <span class="string">utf8mb4</span></span><br><span class="line"><span class="comment"># 数据库字符集对应一些排序等规则，注意要和 character-set-server 对应</span></span><br><span class="line"><span class="attr">collation-server</span> = <span class="string">utf8mb4_general_ci</span></span><br><span class="line"><span class="comment"># 设置 client 连接 mysql 时的字符集，防止乱码</span></span><br><span class="line"><span class="attr">init_connect</span>=<span class="string">&#x27;SET NAMES utf8mb4&#x27;</span></span><br><span class="line"><span class="comment"># 是否对 sql 语句大小写敏感，1 表示不敏感</span></span><br><span class="line"><span class="attr">lower_case_table_names</span> = <span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 用于指定索引缓冲区的大小</span></span><br><span class="line"><span class="attr">key_buffer_size</span>=<span class="string">6G</span></span><br><span class="line"><span class="comment"># 设置一次消息传输的最大值</span></span><br><span class="line"><span class="attr">max_allowed_packet</span>=<span class="string">8M</span></span><br><span class="line"><span class="comment"># 仅仅允许使用键值的 UPDATES 和 DELETES</span></span><br><span class="line"><span class="attr">no-auto-rehash</span></span><br><span class="line"><span class="comment"># 表示 SQL 模式的参数，通过这个参数可以设置检验 SQL 语句的严格程度</span></span><br><span class="line"><span class="attr">sql_mode</span>=<span class="string">TRADITIONAL</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ===================================skip options ======================================</span></span><br><span class="line"><span class="comment"># 禁止 MySQL 对外部连接进行 DNS 解析，使用这一选项可以消除 MySQL 进行 DNS 解析的时间。但需要注意，如果开启该选项，则所有远程主机连接授权都要使用 IP 地址方式，否则 MySQL 将无法正常处理连接请求！</span></span><br><span class="line"><span class="attr">skip-name-resolve</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 不能使用连接文件，多个客户可能会访问同一个数据库，因此这防止外部客户锁定 MySQL 服务器。 该选项默认开启</span></span><br><span class="line"><span class="attr">skip-symbolic-links</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 不使用系统锁定，要使用 myisamchk,必须关闭服务器 ,避免 MySQL的外部锁定，减少出错几率增强稳定性。</span></span><br><span class="line"><span class="attr">skip-external-locking</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 启动 mysql,不启动复制</span></span><br><span class="line"><span class="attr">skip-slave-start</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 开启该选项可以彻底关闭 MySQL 的 TCP/IP 连接方式，如果 WEB 服务器是以远程连接的方式访问 MySQL 数据库服务器则不要开启该选项！否则将无法正常连接！ 如果所有的进程都是在同一台服务器连接到本地的 mysqld, 这样设置将是增强安全的方法</span></span><br><span class="line"><span class="attr">skip-networking</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 把SYSDATE 函数编程为 NOW的别名</span></span><br><span class="line"><span class="attr">sysdate-is-now</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"># 把SYSDATE 函数编程为 NOW的别名</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ============================== 系统资源相关选项 ===============================#</span></span><br><span class="line"><span class="comment"># 接受队列，对于没建立 tcp 连接的请求队列放入缓存中，队列大小为 back_log，受限制与 OS 参数，试图设定 back_log 高于你的操作系统的限制将是无效的。默认值为 50。对于 Linux 系统推荐设置为小于512的整数。如果系统在一个短时间内有很多连接，则需要增大该参数的值</span></span><br><span class="line"><span class="attr">back_log</span> = <span class="string">50 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定MySQL允许的最大连接进程数。如果在访问数据库时经常出现&quot;Too Many Connections&quot;的错误提 示，则需要增大该参数值。</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="string">1000 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果某个用户发起的连接 error 超过该数值，则该用户的下次连接将被阻塞，直到管理员执行 flush hosts ; 命令或者服务重启， 防止黑客 ， 非法的密码以及其他在链接时的错误会增加此值</span></span><br><span class="line"><span class="attr">max_connect_errors</span> = <span class="string">10000 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># MySQL打开的文件描述符限制，默认最小1024;当open_files_limit没有被配置的时候，比较max_connections*5和ulimit-n的值，哪个大用哪个，当open_file_limit被配置的时候，比较open_files_limit和max_connections*5的值，哪个大用哪个。</span></span><br><span class="line"><span class="attr">open_files_limit</span> = <span class="string">10240 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 连接超时之前的最大秒数,在 Linux 平台上，该超时也用作等待服务器首次回应的时间</span></span><br><span class="line"><span class="attr">connect-timeout</span> = <span class="string">10 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 等待关闭连接的时间</span></span><br><span class="line"><span class="attr">wait-timeout</span> = <span class="string">28800 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 关闭连接之前，允许 interactive_timeout（取代了wait_timeout）秒的不活动时间。客户端的会话 wait_timeout 变量被设为会话interactive_timeout 变量的值。如果前端程序采用短连接，建议缩短这2个值, 如果前端程序采用长连接，可直接注释掉这两个选项，默认配置(8小时)  </span></span><br><span class="line"><span class="attr">interactive-timeout</span> = <span class="string">28800 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 从服务器也能够处理网络连接中断。但是，只有从服务器超过slave_net_timeout 秒没有从主服务器收到数据才通知网络中断</span></span><br><span class="line"><span class="attr">slave-net-timeout</span> = <span class="string">600 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 从服务器读取信息的超时</span></span><br><span class="line"><span class="attr">net_read_timeout</span> = <span class="string">30 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 从服务器写入信息的超时</span></span><br><span class="line"><span class="attr">net_write_timeout</span> = <span class="string">60 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果某个通信端口的读操作中断了，在放弃前重试多次</span></span><br><span class="line"><span class="attr">net_retry_count</span> = <span class="string">10 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 包消息缓冲区初始化为 net_buffer_length 字节，但需要时可以增长到 max_allowed_packet 字节</span></span><br><span class="line"><span class="attr">net_buffer_length</span> = <span class="string">16384 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 服务所能处理的请求包的最大大小以及服务所能处理的最大的请求大小(当与大的BLOB 字段一起工作时相当必要)， 每个连接独立的大小.大小动态增加。 设置最大包,限制server接受的数据包大小，避免超长SQL的执行有问题 默认值为16M，当MySQL客户端或mysqld</span></span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="string">64M</span></span><br><span class="line"><span class="attr">服务器收到大于</span> <span class="string">max_allowed_packet 字节的信息包时，将发出“信息包过大”错误，并关闭连接。对于某些客户端，如果通信信息包过大，在执行查询期间，可能会遇到“丢失与 MySQL 服务器的连接”错误。默认值 16M。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 所有线程所打开表的数量. 增加此值就增加了mysqld所需要的文件描述符的数量这样你需要确认在[mysqld_safe]中 “open-files-limit” 变量设置打开文件数量允许至少4096</span></span><br><span class="line"><span class="attr">table_cache</span> = <span class="string">512 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 线程使用的堆大小. 此容量的内存在每次连接时被预留.MySQL 本身常不会需要超过 64K 的内存如果你使用你自己的需要大量堆的 UDF 函数或者你的操作系统对于某些操作需要更多的堆,你也许需要将其设置的更高一点.默认设置足以满足大多数应用</span></span><br><span class="line"><span class="attr">thread_stack</span> = <span class="string">192K </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 我们在 cache 中保留多少线程用于重用.当一个客户端断开连接后,如果 cache 中的线程还少于 thread_cache_size,则客户端线程被放入 cache 中.这可以在你需要大量新连接的时候极大的减少线程创建的开销(一般来说如果你有好的线程模型的话,这不会有明显的性能提升.)服务器线程缓存这个值表示可以重新利用保存在缓存中线程的数量,当断开连接时如果缓存中还有空间,那么客户端的线程将被放到缓存中,如果线程重新被请求，那么请求将从缓存中读取,如果缓存中是空的或者是新的请求，那么这个线程将被重新创建,如果有很多新的线程，增加这个值可以改善系统性能.通过比较 Connections 和 Threads_created 状态的变量，可以看到这个变量的作用</span></span><br><span class="line"><span class="comment">#   根据物理内存设置规则如下：</span></span><br><span class="line"><span class="comment">#   1G  —&gt; 8</span></span><br><span class="line"><span class="comment">#   2G  —&gt; 16</span></span><br><span class="line"><span class="comment">#   3G  —&gt; 32</span></span><br><span class="line"><span class="comment">#   大于3G  —&gt; 64</span></span><br><span class="line"><span class="attr">thread_cache_size</span> = <span class="string">20 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 此允许应用程序给予线程系统一个提示在同一时间给予渴望被运行的线程的数量.该参数取值为服务器逻辑CPU数量×2，在本例中，服务器有 2 颗物理CPU，而每颗物理CPU又支持H.T超线程，所以实际取值为 4 × 2 ＝ 8.设置 thread_concurrency的值的正确与否, 对 mysql 的性能影响很大, 在多个 cpu(或多核)的情况下，错误设置了 thread_concurrency 的值, 会导致 mysql 不能充分利用多 cpu(或多核),出现同一时刻只能一个 cpu(或核)在工作的情况。 thread_concurrency 应设为 CPU 核数的 2 倍.比如有一个双核的 CPU, 那么 thread_concurrency 的应该为 4; 2 个双核的 cpu,thread_concurrency 的值应为 8,属重点优化参数</span></span><br><span class="line"><span class="attr">thread_concurrency</span> = <span class="string">8 </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"># =============================qcache settings 相关选项 ==================================#</span></span><br><span class="line"><span class="comment"># 不缓存查询大于该值的结果.只有小于此设定值的结果才会被缓冲,  此设置用来保护查询缓冲,防止一个极大的结果集将其他所有的查询结果都覆盖.</span></span><br><span class="line"><span class="attr">query_cache_limit</span> = <span class="string">2M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 查询缓存分配的最小块大小.默认是 4KB，设置值大对大数据查询有好处，但如果你的查询都是小数据查询，就容易造成内存碎片和浪费</span></span><br><span class="line"><span class="comment">#   查询缓存碎片率 = Qcache_free_blocks / Qcache_total_blocks * 100%</span></span><br><span class="line"><span class="comment">#   如果查询缓存碎片率超过 20%，可以用 FLUSH QUERY CACHE 整理缓存碎片，或者试试减小query_cache_min_res_unit，如果你的查询都是小数据量的话。</span></span><br><span class="line"><span class="comment">#   查询缓存利用率 = (query_cache_size – Qcache_free_memory) / query_cache_size *100%</span></span><br><span class="line"><span class="comment">#   查询缓存利用率在 25%以下的话说明 query_cache_size 设置的过大，可适当减小;查询缓存利用率在 80%以上而且 Qcache_lowmem_prunes &gt; 50 的话说明 query_cache_size 可能有点小，要不就是碎片太多。</span></span><br><span class="line"><span class="comment">#   查询缓存命中率 = (Qcache_hits – Qcache_inserts) / Qcache_hits * 100%</span></span><br><span class="line"><span class="attr">query_cache_min_res_unit</span> = <span class="string">2K </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定 MySQL 查询缓冲区的大小。可以通过在 MySQL 控制台执行以下命令观察：</span></span><br><span class="line"><span class="comment">#   代码:</span></span><br><span class="line"><span class="comment">#   &gt; SHOW VARIABLES LIKE &#x27;%query_cache%&#x27;;</span></span><br><span class="line"><span class="comment">#   &gt; SHOW STATUS LIKE &#x27;Qcache%&#x27;;如果 Qcache_lowmem_prunes 的值非常大，则表明经常出现缓冲不够的情况；</span></span><br><span class="line"><span class="comment">#   如果 Qcache_hits 的值非常大，则表明查询缓冲使用非常频繁，如果该值较小反而会影响效率，那么可以考虑不用查询缓冲； Qcache_free_blocks，如果该值非常大，则表明缓冲区中碎片很多。</span></span><br><span class="line"><span class="comment">#   memlock # 如果你的系统支持 memlock() 函数,你也许希望打开此选项用以让运行中的 mysql 在在内存高度</span></span><br><span class="line"><span class="comment">#   紧张的时候,数据在内存中保持锁定并且防止可能被 swapping out,此选项对于性能有益</span></span><br><span class="line"><span class="attr">query_cache_size</span> = <span class="string">64M  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># =================================default settings 相关选项========================================</span></span><br><span class="line"><span class="comment"># 当创建新表时作为默认使用的表类型,如果在创建表示没有特别执行表类型,将会使用此值</span></span><br><span class="line"><span class="attr">default_table_type</span> = <span class="string">InnoDB </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#服务器时区</span></span><br><span class="line"><span class="attr">default-time-zone</span> = <span class="string">system </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#默认存储引擎</span></span><br><span class="line"><span class="attr">default-storage-engine</span> = <span class="string">InnoDB </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ====================================tmp &amp;&amp; heap settings ========================================</span></span><br><span class="line"><span class="comment">#临时表的最大大小，如果超过该值，则结果放到磁盘中,此限制是针对单个表的,而不是总和.</span></span><br><span class="line"><span class="attr">tmp_table_size</span> = <span class="string">512M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#独立的内存表所允许的最大容量.此选项为了防止意外创建一个超大的内存表导致永尽所有的内存资源.</span></span><br><span class="line"><span class="attr">max_heap_table_size</span> = <span class="string">512M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#  ======================================log settings 相关选项 ======================================</span></span><br><span class="line"><span class="comment"># 打开二进制日志功能.在复制(replication)配置中,作为 MASTER 主服务器必须打开此项.如果你需要从你最后的备份中做基于时间点的恢复,你也同样需要二进制日志.这些路径相对于 datadir</span></span><br><span class="line"><span class="attr">log-bin</span> = <span class="string">mysql-bin </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 表示slave将复制事件写进自己的二进制日志</span></span><br><span class="line"><span class="attr">log_slave_updates</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 二进制的索引文件名</span></span><br><span class="line"><span class="attr">log-bin-index</span> = <span class="string">mysql-bin.index </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 定义relay_log的位置和名称，如果值为空，则默认位置在数据文件的目录，文件名为host_name-relay-bin.nnnnnn（By default, relay log file names have the form host_name-relay-bin.nnnnnn in the data directory）；</span></span><br><span class="line"><span class="attr">relay-log</span> = <span class="string">relay-log </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># relay-log的索引文件名</span></span><br><span class="line"><span class="attr">relay_log_index</span> = <span class="string">relay-log.index  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 将警告打印输出到错误 log 文件.如果你对于MySQL有任何问题，你应该打开警告 log 并且仔细审查错误日志,查出可能的原因.</span></span><br><span class="line"><span class="attr">log-warnings</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 错误日志路径</span></span><br><span class="line"><span class="attr">log-error</span> =  <span class="string">/usr/local/mysql/log/mysql.err </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 参数 log_output 指定了慢查询输出的格式，默认为 FILE，你可以将它设为 TABLE，然后就可以查询 mysql 架构下的 slow_log 表了</span></span><br><span class="line"><span class="attr">log_output</span> = <span class="string">FILE </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定是否开启慢查询日志(该参数要被slow_query_log取代，做兼容性保留)</span></span><br><span class="line"><span class="attr">log_slow_queries</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定是否开启慢查询日志. 慢查询是指消耗了比 “long_query_time” 定义的更多时间的查询.如果 log_long_format 被打开,那些没有使用索引的查询也会被记录.如果你经常增加新查询到已有的系统内的话. 一般来说这是一个好主意,</span></span><br><span class="line"><span class="attr">slow_query_log</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设定慢查询的阀值，超出次设定值的SQL即被记录到慢查询日志，缺省值为10s.所有的使用了比这个时间(以秒为单位)更多的查询会被认为是慢速查询.不要在这里使用”1″, 否则会导致所有的查询,甚至非常快的查询页被记录下来(由于MySQL 目前时间的精确度只能达到秒的级别).</span></span><br><span class="line"><span class="attr">long-query-time</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 在慢速日志中记录更多的信息.一般此项最好打开，打开此项会记录使得那些没有使用索引的查询也被作为到慢速查询附加到慢速日志里</span></span><br><span class="line"><span class="attr">log_long_format</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定慢日志文件存放位置，可以为空，系统会给一个缺省的文件host_name-slow.log</span></span><br><span class="line"><span class="attr">slow_query_log_file</span> =  <span class="string">/usr/local/mysql/log/slow.log </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果运行的SQL语句没有使用索引，则mysql数据库同样会将这条SQL语句记录到慢查询日志文件中。</span></span><br><span class="line"><span class="attr">log-queries-not-using-indexes</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 记录那些由于查找了多余1000次而引发的慢查询</span></span><br><span class="line"><span class="attr">min_examined_row_limit</span>=<span class="string">1000　　　　</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 记录那些慢的optimize table，analyze table和alter table语句</span></span><br><span class="line"><span class="attr">long-slow-admin-statements</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 记录由Slave所产生的慢查询</span></span><br><span class="line"><span class="attr">log-slow-slave-statements</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 将所有到达MySQL Server的SQL语句记录下来,默认关闭 </span></span><br><span class="line"><span class="attr">general_log</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># general_log路径</span></span><br><span class="line"><span class="attr">general_log_file</span> =  <span class="string">/usr/local/mysql/log/mysql.log </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果二进制日志写入的内容超出给定值，日志就会发生滚动。你不能将该变量设置为大于1GB或小于4096字节。 默认值是1GB。如果你正使用大的事务，二进制日志还会超过max_binlog_size</span></span><br><span class="line"><span class="attr">max_binlog_size</span> = <span class="string">1G </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 标记relaylog允许的最大值，如果该值为0，则默认值为max_binlog_size(1G)；如果不为0，则max_relay_log_size则为最大的relay_log文件大小；</span></span><br><span class="line"><span class="attr">max_relay_log_size</span> = <span class="string">1G </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 是否自动清空不再需要中继日志时。默认值为1(启用)</span></span><br><span class="line"><span class="attr">relay-log-purge</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 超过 30 天的 binlog 删除</span></span><br><span class="line"><span class="attr">expire_logs_days</span> = <span class="string">30 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 在一个事务中 binlog 为了记录 SQL 状态所持有的 cache 大小,如果你经常使用大的,多声明的事务,你可以增加此值来获取更大的性能.所有从事务来的状态都将被缓冲在 binlog 缓冲中然后在提交后一次性写入到 binlog 中,如果事务比此值大, 会使用磁盘上的临时文件来替代.此缓冲在每个连接的事务第一次更新状态时被创建.session 级别</span></span><br><span class="line"><span class="attr">binlog_cache_size</span> = <span class="string">1M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 复制时忽略数据库及表</span></span><br><span class="line"><span class="attr">replicate-wild-ignore-table</span> = <span class="string">mysql.% </span></span><br><span class="line"><span class="comment"># 定义复制过程中从服务器可以自动跳过的错误号，当复制过程中遇到定义的错误号，就可以自动跳过，直接执行后面的SQL语句。</span></span><br><span class="line"><span class="comment"># slave_skip_errors选项有四个可用值，分别为：off，all，ErorCode，ddl_exist_errors。</span></span><br><span class="line"><span class="comment">#  默认情况下该参数值是off，我们可以列出具体的error code，也可以选择all，mysql5.6及MySQL Cluster NDB 7.3以及后续版本增加了参数ddl_exist_errors，该参数包含一系列error code（1007,1008,1050,1051,1054,1060,1061,1068,1094,1146）</span></span><br><span class="line"><span class="comment">#    一些error code代表的错误如下：</span></span><br><span class="line"><span class="comment">#    1007：数据库已存在，创建数据库失败</span></span><br><span class="line"><span class="comment">#    1008：数据库不存在，删除数据库失败</span></span><br><span class="line"><span class="comment">#    1050：数据表已存在，创建数据表失败</span></span><br><span class="line"><span class="comment">#    1051：数据表不存在，删除数据表失败</span></span><br><span class="line"><span class="comment">#    1054：字段不存在，或程序文件跟数据库有冲突</span></span><br><span class="line"><span class="comment">#    1060：字段重复，导致无法插入</span></span><br><span class="line"><span class="comment">#    1061：重复键名</span></span><br><span class="line"><span class="comment">#    1068：定义了多个主键</span></span><br><span class="line"><span class="comment">#    1094：位置线程ID</span></span><br><span class="line"><span class="comment">#    1146：数据表缺失，请恢复数据库</span></span><br><span class="line"><span class="comment">#    1053：复制过程中主服务器宕机</span></span><br><span class="line"><span class="comment">#    1062：主键冲突 Duplicate entry &#x27;%s&#x27; for key %d</span></span><br><span class="line"><span class="attr">slave_skip_errors</span>=<span class="string">all </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ==========================================MyISAM 相关选项 ========================================</span></span><br><span class="line"><span class="comment">#指定用于索引的缓冲区大小，增加它可得到更好的索引处理性能。如果是以InnoDB引擎为主的DB，专用于MyISAM引擎的 key_buffer_size 可以设置较小，8MB 已足够  如果是以MyISAM引擎为主，可设置较大，但不能超过4G. 在这里，强烈建议不使用MyISAM引擎，默认都是用InnoDB引擎.注意：该参数值设置的过大反而会是服务器整体效率降低！</span></span><br><span class="line"><span class="attr">key_buffer_size</span> = <span class="string">256M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 查询排序时所能使用的缓冲区大小。排序缓冲被用来处理类似 ORDER BY 以及 GROUP BY 队列所引起的排序.一个用来替代的基于磁盘的合并分类会被使用.查看 “Sort_merge_passes” 状态变量. 在排序发生时由每个线程分配 注意：该参数对应的分配内存是每连接独占！如果有 100 个连接，那么实际分配的总共排序缓冲区大小为 100 × 6 ＝600MB,所以,对于内存在 4GB 左右的服务器推荐设置为 6-8M。 </span></span><br><span class="line"><span class="attr">sort_buffer_size</span> = <span class="string">2M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 读查询操作所能使用的缓冲区大小。和 sort_buffer_size 一样，该参数对应的分配内存也是每连接独享！用来做 MyISAM 表全表扫描的缓冲大小.当全表扫描需要时,在对应线程中分配.</span></span><br><span class="line"><span class="attr">read_buffer_size</span> = <span class="string">2M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 联合查询操作所能使用的缓冲区大小，和 sort_buffer_size 一样，该参数对应的分配内存也是每连接独享!此缓冲被使用来优化全联合(full JOINs 不带索引的联合).类似的联合在极大多数情况下有非常糟糕的性能表现, 但是将此值设大能够减轻性能影响.通过 “Select_full_join”状态变量查看全联合的数量， 当全联合发生时,在每个线程中分配。</span></span><br><span class="line"><span class="attr">join_buffer_size</span> = <span class="string">8M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># MyISAM 以索引扫描(Random Scan)方式扫描数据的 buffer大小 </span></span><br><span class="line"><span class="attr">read_rnd_buffer_size</span> = <span class="string">8M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># MyISAM 使用特殊的类似树的 cache 来使得突发插入(这些插入是,INSERT … SELECT, INSERT … VALUES (…), (…), …, 以及 LOAD DATAINFILE) 更快. 此变量限制每个进程中缓冲树的字节数.设置为 0 会关闭此优化.为了最优化不要将此值设置大于 “key_buffer_size”.当突发插入被检测到时此缓冲将被分配MyISAM 用在块插入优化中的树缓冲区的大小。注释：这是一个 per thread 的限制 （ bulk 大量）.此缓冲当 MySQL 需要在 REPAIR, OPTIMIZE, ALTER 以及 LOAD DATA INFILE到一个空表中引起重建索引时被分配.这在每个线程中被分配.所以在设置大值时需要小心.</span></span><br><span class="line"><span class="attr">bulk_insert_buffer_size</span> = <span class="string">64M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># MyISAM 设置恢复表之时使用的缓冲区的尺寸,当在REPAIR TABLE 或用 CREATE INDEX 创建索引或 ALTER TABLE 过程中排序 MyISAM 索引分配的缓冲区</span></span><br><span class="line"><span class="attr">myisam_sort_buffer_size</span> = <span class="string">64M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mysql重建索引时允许使用的临时文件最大大小</span></span><br><span class="line"><span class="attr">myisam_max_sort_file_size</span> = <span class="string">10G</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果该值大于 1，在 Repair by sorting 过程中并行创建MyISAM 表索引(每个索引在自己的线程内).如果一个表拥有超过一个索引, MyISAM 可以通过并行排序使用超过一个线程去修复他们.这对于拥有多个 CPU 以及大量内存情况的用户,是一个很好的选择.</span></span><br><span class="line"><span class="attr">myisam_repair_threads</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 允许的 GROUP_CONCAT()函数结果的最大长度</span></span><br><span class="line"><span class="attr">myisam_recover</span> = <span class="string">64K</span></span><br><span class="line"><span class="comment"># 设定默认的事务隔离级别.可用的级别如下:READ-UNCOMMITTED, READ-COMMITTED, REPEATABLE-READ,SERIALIZABLE</span></span><br><span class="line"><span class="comment"># 1.READ UNCOMMITTED-读未提交 2.READ COMMITTE-读已提交 3.REPEATABLE READ -可重复读 4.SERIALIZABLE -串行</span></span><br><span class="line"><span class="attr">transaction_isolation</span> = <span class="string">REPEATABLE-READ </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ======================================== INNODB 相关选项 =========================================</span></span><br><span class="line"><span class="comment"># 如果你的 MySQL 服务包含 InnoDB 支持但是并不打算使用的话,使用此选项会节省内存以及磁盘空间,并且加速某些部分</span></span><br><span class="line"><span class="attr">skip-innodb</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># InnoDB为独立表空间模式，每个数据库的每个表都会生成一个数据空间</span></span><br><span class="line"><span class="comment">#  独立表空间优点：</span></span><br><span class="line"><span class="comment">#   1．每个表都有自已独立的表空间。</span></span><br><span class="line"><span class="comment">#   2．每个表的数据和索引都会存在自已的表空间中。</span></span><br><span class="line"><span class="comment">#   3．可以实现单表在不同的数据库中移动。</span></span><br><span class="line"><span class="comment">#   4．空间可以回收（除drop table操作处，表空不能自已回收）</span></span><br><span class="line"><span class="comment">#  缺点：</span></span><br><span class="line"><span class="comment">#   1.单表增加过大，如超过100G</span></span><br><span class="line"><span class="comment">#  结论：</span></span><br><span class="line"><span class="comment">#   共享表空间在Insert操作上少有优势。其它都没独立表空间表现好。当启用独立表空间时，请合理调整：innodb_open_files</span></span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 启用InnoDB的status file，便于管理员查看以及监控等</span></span><br><span class="line"><span class="attr">innodb_status_file</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 限制Innodb能打开的表的数据，如果库里的表特别多的情况，请增加这个。这个值默认是300</span></span><br><span class="line"><span class="attr">innodb_open_files</span> = <span class="string">2048 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置InnoDB存储引擎用来存放数据字典信息以及一些内部数据结构的内存空间大小，所以当我们一个MySQL Instance中的数据库对象非常多的时候，是需要适当调整该参数的大小以确保所有数据都能存放在内存中提高访问效率的。 </span></span><br><span class="line"><span class="attr">innodb_additional_mem_pool_size</span> = <span class="string">100M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 包括数据页、索引页、插入缓存、锁信息、自适应哈希所以、数据字典信息.InnoDB 使用一个缓冲池来保存索引和原始数据, 不像 MyISAM.这里你设置越大,你在存取表里面数据时所需要的磁盘 I/O 越少.在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的 80%,不要设置过大,否则,由于物理内存的竞争可能导致操作系统的换页颠簸.注意在 32 位系统上你每个进程可能被限制在 2-3.5G 用户层面内存限制,所以不要设置的太高.</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="string">2G </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># innodb使用后台线程处理数据页上的读写 I/O(输入输出)请求,根据你的 CPU 核数来更改,默认是4</span></span><br><span class="line"><span class="comment"># 注:这两个参数不支持动态改变,需要把该参数加入到my.cnf里，修改完后重启MySQL服务,允许值的范围从 1-64</span></span><br><span class="line"><span class="attr">innodb_write_io_threads</span> = <span class="string">4</span></span><br><span class="line"><span class="attr">innodb_read_io_threads</span> = <span class="string">4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 设置此选项如果你希望 InnoDB 表空间文件被保存在其他分区.默认保存在 MySQL 的 datadir 中.</span></span><br><span class="line"><span class="attr">innodb_data_home_dir</span> =  <span class="string">/usr/local/mysql/var/ </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># InnoDB将数据保存在一个或者多个数据文件中成为表空间.如果你只有单个逻辑驱动保存你的数据,一个单个的自增文件就足够好了.其他情况下.每个设备一个文件一般都是个好的选择.你也可以配置 InnoDB 来使用裸盘分区 – 请参考手册来获取更多相关内容</span></span><br><span class="line"><span class="attr">innodb_data_file_path</span> = <span class="string">ibdata1:500M;ibdata2:2210M:autoextend</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 用来同步 IO 操作的 IO 线程的数量. 此值在 Unix 下被硬编码为 4,但是在 Windows 磁盘 I/O 可能在一个大数值下表现的更好.</span></span><br><span class="line"><span class="attr">innodb_file_io_threads</span> = <span class="string">4 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 在InnoDb 核心内的允许线程数量,InnoDB 试着在 InnoDB 内保持操作系统线程的数量少于或等于这个参数给出的限制,最优值依赖于应用程序,硬件以及操作系统的调度方式.过高的值可能导致线程的互斥颠簸.默认设置为 0,表示不限制并发数，这里推荐设置为0，更好去发挥CPU多核处理能力，提高并发量</span></span><br><span class="line"><span class="attr">innodb_thread_concurrency</span> = <span class="string">16</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果设置为 1 ,InnoDB 会在每次提交后刷新(fsync)事务日志到磁盘上,这提供了完整的 ACID 行为.如果你愿意对事务安全折衷, 并且你正在运行一个小的食物, 你可以设置此值到 0 或者 2 来减少由事务日志引起的磁盘 I/O</span></span><br><span class="line"><span class="comment">#   0 代表日志只大约每秒写入日志文件并且日志文件刷新到磁盘.</span></span><br><span class="line"><span class="comment">#   2 代表日志写入日志文件在每次提交后,但是日志文件只有大约每秒才会刷新到磁盘上.</span></span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span> = <span class="string">1 </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"># 用来缓冲日志数据的缓冲区的大小.当此值快满时, InnoDB 将必须刷新数据到磁盘上.由于基本上每秒都会刷新一次,所以没有必要将此值设置的太大(甚至对于长事务而言)</span></span><br><span class="line"><span class="attr">innodb_log_buffer_size</span> = <span class="string">8M</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 事物日志大小.在日志组中每个日志文件的大小，你应该设置日志文件总合大小到你缓冲池大小的5%~100%，来避免在日志文件覆写上不必要的缓冲池刷新行为.不论如何, 请注意一个大的日志文件大小会增加恢复进程所需要的时间.</span></span><br><span class="line"><span class="attr">innodb_log_file_size</span> = <span class="string">500M </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 在日志组中的文件总数.通常来说 2~3 是比较好的.</span></span><br><span class="line"><span class="attr">innodb_log_files_in_group</span> = <span class="string">2 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># InnoDB 的日志文件所在位置. 默认是 MySQL 的 datadir.你可以将其指定到一个独立的硬盘上或者一个 RAID1 卷上来提高其性能innodb_max_dirty_pages_pct = 90 #innodb 主线程刷新缓存池中的数据，使脏数据比例小于 90%,这是一个软限制,不被保证绝对执行.</span></span><br><span class="line"><span class="attr">innodb_log_group_home_dir</span> =  <span class="string">/usr/local/mysql/var/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># InnoDB 事务在被回滚之前可以等待一个锁定的超时秒数。InnoDB 在它自己的 锁定表中自动检测事务死锁并且回滚事务。 InnoDB 用 LOCK TABLES 语句注意到锁定设置。默认值是 50 秒</span></span><br><span class="line"><span class="attr">innodb_lock_wait_timeout</span> = <span class="string">50 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># InnoDB 用来刷新日志的方法.表空间总是使用双重写入刷新方法.默认值是 “fdatasync”, 另一个是 “O_DSYNC”.</span></span><br><span class="line"><span class="attr">innodb_flush_method</span> = <span class="string">O_DSYNC </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果你发现 InnoDB 表空间损坏, 设置此值为一个非零值可能帮助你导出你的表.从1 开始并且增加此值知道你能够成功的导出表.</span></span><br><span class="line"><span class="attr">innodb_force_recovery</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 加速 InnoDB 的关闭. 这会阻止 InnoDB 在关闭时做全清除以及插入缓冲合并.这可能极大增加关机时间, 但是取而代之的是 InnoDB 可能在下次启动时做这些操作.</span></span><br><span class="line"><span class="attr">innodb_fast_shutdown</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ===================================== 其他 相关选项 ===========================================</span></span><br><span class="line"><span class="attr">[mysqldump]</span></span><br><span class="line"><span class="comment"># 支持较大数据库的转储，在导出非常巨大的表时需要此项。增加该变量的值十分安全，这是因为仅当需要时才会分配额外内存。例如，仅当你发出长查询或mysqld必须返回大的结果行时mysqld才会分配更多内存。该变量之所以取较小默认值是一种预防措施，以捕获客户端和服务器之间的错误信息包，并确保不会因偶然使用大的信息包而导致内存溢出。 如果你正是用大的BLOB值，而且未为mysqld授予为处理查询而访问足够内存的权限，也会遇到与大信息包有关的奇怪问题。如果怀疑出现了该情况，请尝试在mysqld_safe脚本开始增加ulimit -d 256000，并重启mysqld。</span></span><br><span class="line"><span class="attr">quick</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysql]</span></span><br><span class="line"><span class="comment"># 允许通过 TAB 键提示</span></span><br><span class="line"><span class="attr">auto-rehash</span> <span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 数据库字符集</span></span><br><span class="line"><span class="attr">default-character-set</span> = <span class="string">utf8 </span></span><br><span class="line"></span><br><span class="line"><span class="attr">connect-timeout</span> = <span class="string">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqld_safe]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 增加每个进程的可打开文件数量.确认你已经将全系统限制设定的足够高!打开大量表需要将此值设大</span></span><br><span class="line"><span class="attr">open-files-limit</span> = <span class="string">8192 </span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>mysql一般生产配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[client]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">socket</span>=<span class="string">/usr/local/mysql/mysql.sock</span></span><br><span class="line"></span><br><span class="line"><span class="attr">port</span>=<span class="string">3306</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">basedir</span>=<span class="string">/usr/local/mysql/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">datadir</span>=<span class="string">/usr/local/mysql/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">socket</span>=<span class="string">/usr/local/mysql/mysql.sock</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default-storage-engine</span>=<span class="string">INNODB</span></span><br><span class="line"></span><br><span class="line"><span class="attr">character_set_server</span>=<span class="string">utf8mb4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">collation_server</span>=<span class="string">utf8mb4_general_ci </span></span><br><span class="line"></span><br><span class="line"><span class="attr">port</span>=<span class="string">3306</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line"></span><br><span class="line"><span class="attr">symbolic-links</span>=<span class="string">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log-error</span>=<span class="string">/usr/local/mysql/log/mysqld3306.log</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pid-file</span>=<span class="string">/usr/local/mysql/mysqld3306.pid</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log_bin</span>=<span class="string">mysql3306-bin</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server_id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##二进制日志格式STATEMENT，ROW，MIXED</span></span><br><span class="line"></span><br><span class="line"><span class="attr">binlog_format</span>=<span class="string">ROW</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## 最大连接数,MySQL服务器允许的最大连接数16384,连接数越多消耗内存越多</span></span><br><span class="line"></span><br><span class="line"><span class="attr">max_connections</span> = <span class="string">1000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## Enable Per Table Data for InnoDB to shrink ibdata1(innoDB表优化)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## 日志过期时间,包括二进制日志(过期自动删除)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">expire_logs_days</span> = <span class="string">15</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#默认128M,用于存储页面缓存数据外，另外正常情况下还有大约8%的开销，主要用在每个缓存页帧的描述、adaptive hash等数据结构,适当的增加这个参数的大小，可以有效的减少 InnoDB 类型的表的磁盘 I/O</span></span><br><span class="line"></span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="string">2048M</span></span><br><span class="line"></span><br><span class="line"><span class="attr">innodb_log_file_size</span> = <span class="string">512M</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#默认是8MB,InnoDB在写事务日志的时候，为了提高性能，也是先将信息写入Innofb Log Buffer中，当满足innodb_flush_log_trx_commit参数所设置的相应条件(或者日志缓冲区写满)之后，才会将日志写到文件 (或者同步到磁盘)中</span></span><br><span class="line"></span><br><span class="line"><span class="attr">innodb_log_buffer_size</span> = <span class="string">8M</span></span><br><span class="line"></span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span> = <span class="string">2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#表大小写不敏感</span></span><br><span class="line"></span><br><span class="line"><span class="attr">lower_case_table_names</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#网络读写超时时间</span></span><br><span class="line"></span><br><span class="line"><span class="attr">net_read_timeout</span>=<span class="string">28800</span></span><br><span class="line"></span><br><span class="line"><span class="attr">net_write_timeout</span>=<span class="string">28800</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#跳过密码  安装完后屏蔽该选项</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#skip-grant-tables</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>慢查询查看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.slow_log</span><br></pre></td></tr></table></figure>



<h1 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h1><h2 id="mysql-启动报错Host-name-could-not-be-resolved解决办法"><a href="#mysql-启动报错Host-name-could-not-be-resolved解决办法" class="headerlink" title="mysql 启动报错Host name could not be resolved解决办法"></a>mysql 启动报错Host name could not be resolved解决办法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">下面一行加入skip-name-resolve重启mysql服务就可以了</span><br></pre></td></tr></table></figure>





<h2 id="mysql配置完成后，启动mysql服务后，连接mysql报错：ERROR-2002-HY000-Can’t-connect-to-local-MySQL-server-through-socket-‘-x2F-var-x2F-lib-x2F-mysql-x2F-mysql-sock’-2"><a href="#mysql配置完成后，启动mysql服务后，连接mysql报错：ERROR-2002-HY000-Can’t-connect-to-local-MySQL-server-through-socket-‘-x2F-var-x2F-lib-x2F-mysql-x2F-mysql-sock’-2" class="headerlink" title="mysql配置完成后，启动mysql服务后，连接mysql报错：ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock’ (2)"></a>mysql配置完成后，启动mysql服务后，连接mysql报错：ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock’ (2)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">[mysql]</span><br><span class="line">[client]</span><br><span class="line">下面的socket属性配置不一致</span><br></pre></td></tr></table></figure>



<h2 id="缺失包"><a href="#缺失包" class="headerlink" title="缺失包"></a>缺失包</h2><h3 id="安装mysql-community-libs-compat时报错如下："><a href="#安装mysql-community-libs-compat时报错如下：" class="headerlink" title="安装mysql-community-libs-compat时报错如下："></a>安装mysql-community-libs-compat时报错如下：</h3><blockquote>
<p>错误：依赖检测失败：<br>    libcrypto.so.10()(64bit) 被 mysql-community-libs-compat-5.7.40-1.el7.x86_64 需要<br>    libcrypto.so.10(libcrypto.so.10)(64bit) 被 mysql-community-libs-compat-5.7.40-1.el7.x86_64 需要<br>    libssl.so.10()(64bit) 被 mysql-community-libs-compat-5.7.40-1.el7.x86_64 需要<br>    libssl.so.10(libssl.so.10)(64bit) 被 mysql-community-libs-compat-5.7.40-1.el7.x86_64 需要</p>
</blockquote>
<p>过程 ：google时发现库</p>
<p><a target="_blank" rel="noopener" href="https://pkgs.org/download/libcrypto.so.10()(64bit)">https://pkgs.org/download/libcrypto.so.10()(64bit)</a></p>
<p>发现了compat-openssl10以及解释，大意为compat-openssl10只包含libraries，提供与不支持使用OpenSSL-1.1编译的早期版本和软件的兼容性。</p>
<blockquote>
<p>The OpenSSL toolkit provides support for secure communications between machines. This version of OpenSSL package contains only the libraries and is provided for compatibility with previous releases and software that does not support compilation with OpenSSL-1.1.</p>
</blockquote>
<p>从stackoverflow可以发现openssl提供了libcrypto.so.10却没有模块名，让系统以为缺少依赖</p>
<blockquote>
<p>In your case, openssl seems to provide only libcrypto.so.10 without any module name, making geramer-server believe that dependency is missing as it requires libcrypto.so.10 from module libcrypto.so.10.</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/20518183/dependency-resolution-fails-on-installed-library">https://stackoverflow.com/questions/20518183/dependency-resolution-fails-on-installed-library</a></p>
<p>解决：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install compat-openssl10 -y</span><br></pre></td></tr></table></figure>

<h3 id="安装mysql-community-client时错报"><a href="#安装mysql-community-client时错报" class="headerlink" title="安装mysql-community-client时错报"></a>安装mysql-community-client时错报</h3><blockquote>
<p>警告：mysql-community-client-5.7.40-1.el7.x86_64.rpm: 头V4 RSA&#x2F;SHA256 Signature, 密钥 ID 3a79bd29: NOKEY<br>错误：依赖检测失败：<br>    libncurses.so.5()(64bit) 被 mysql-community-client-5.7.40-1.el7.x86_64 需要<br>    libtinfo.so.5()(64bit) 被 mysql-community-client-5.7.40-1.el7.x86_64 需要</p>
</blockquote>
<p>解决：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install libncurses*</span><br></pre></td></tr></table></figure>



<h2 id="安装mysql-community-server报错"><a href="#安装mysql-community-server报错" class="headerlink" title="安装mysql-community-server报错"></a>安装mysql-community-server报错</h2><p>错误信息如下：</p>
<blockquote>
<p>[&#x2F;usr&#x2F;lib&#x2F;tmpfiles.d&#x2F;mysql.conf:23] Line references path below legacy directory &#x2F;var&#x2F;run&#x2F;, updating &#x2F;var&#x2F;run&#x2F;mysqld → &#x2F;run&#x2F;mysqld; please update the tmpfiles.d&#x2F; drop-in file accordingly.</p>
</blockquote>
<p>按照错误提示：编辑&#x2F;usr&#x2F;lib&#x2F;tmpfiles.d&#x2F;mysql.conf文件，将 &#x2F;var&#x2F;run&#x2F;mysqld路径改为&#x2F;run&#x2F;mysqld</p>
<h2 id="修改数据目录后启动报错"><a href="#修改数据目录后启动报错" class="headerlink" title="修改数据目录后启动报错"></a>修改数据目录后启动报错</h2><blockquote>
<p>2月 28 00:22:29 localhost.localdomain setroubleshoot[46262]: SELinux is preventing &#x2F;usr&#x2F;sbin&#x2F;mysqld from write access on the dir&gt;<br>2月 28 00:22:29 localhost.localdomain setroubleshoot[46262]: SELinux is preventing &#x2F;usr&#x2F;sbin&#x2F;mysqld from write access on the dir&gt;<br>              *****  Plugin catchall_labels (83.8 confidence) suggests   *******</p>
<p>​              If you want to allow mysqld to have write access on the data direc&gt;<br>​              Then you need to change the label on &#x2F;mysql&#x2F;data<br>​              Do<br>​              #semanage fcontext -a -t FILE_TYPE ‘&#x2F;mysql&#x2F;data’<br>​              where FILE_TYPE is one of the following: faillog_t, krb5_host_rcac&gt;<br>​              Then execute:<br>​              restorecon -v ‘&#x2F;mysql&#x2F;data’</p>
<p>​             *****Plugin catchall (17.1 confidence) suggests   **************</p>
<p>​              If you believe that mysqld should be allowed write access on the d<br>​              Then you should report this as a bug.<br>​              You can generate a local policy module to allow this access.<br>​              Do</p>
<p>​              allow this access for now by executing:</p>
<p>​              #ausearch -c ‘mysqld’ –raw | audit2allow -M my-mysqld</p>
<p>​              #semodule -X 300 -i my-mysqld.pp</p>
<p>2月 28 00:22:29 localhost.localdomain setroubleshoot[46262]: AnalyzeThread.run(): Set alarm timeout to 10<br>2月 28 00:22:29 localhost.localdomain setroubleshoot[46262]: AnalyzeThread.run(): Cancel pending alarm<br>2月 28 00:22:29 localhost.localdomain setroubleshoot[46262]: failed to retrieve rpm info for &#x2F;mysql&#x2F;data</p>
</blockquote>
<p>解决方法：</p>
<p>该问题是由于Selinux安全策略造成的，我们可以按照错误提示进行修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行命令前先把mysql生成的文件删除以防把自动生成的文件策略修改</span></span><br><span class="line">semanage fcontext -a -t mysqld_db_t /mysql/data</span><br><span class="line">restorecon -v /mysql/data</span><br></pre></td></tr></table></figure>

<p>还可以用其他命令<code>chcon -R -t mysqld_db_t -u system_u -r object_r 新的mysql-data目录</code>（直接修改文件夹安全权限）或者<code>chcon -R --reference=/var/lib/mysql 新的mysql-data目录</code>（复制源文件夹的权限给新文件夹）；不过由于本人没有深入了解这些命令造成修改成功了一部分，未完全修改成功</p>
<p>​          </p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">求打赏</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/michaelchan90/blog-imgbed/img/AliPay.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/michaelchan90/blog-imgbed/img/AliPay.png" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><span class="icon iconify" data-icon="ri:alipay-line"></span></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/michaelchan90/blog-imgbed/img/WechatPay.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/michaelchan90/blog-imgbed/img/WechatPay.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><span class="icon iconify" data-icon="ri:wechat-pay-line"></span></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Michael Chan</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://michaelchan90.github.io/2023/02/10/Centos7%E5%AE%89%E8%A3%85MySQL/" title="Centos7安装MySQL">http://michaelchan90.github.io/2023/02/10/Centos7%E5%AE%89%E8%A3%85MySQL/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul><script>document.addEventListener('copy', function (event) {
  const clipboardData = event.clipboardData || window.clipboardData;
  if (!clipboardData) { return; }
  const text = window.getSelection().toString();
  if (text) {
    event.preventDefault();
    clipboardData.setData('text/plain', text + '\n\n本文作者：Michael Chan\n本文链接：http://michaelchan90.github.io/2023/02/10/Centos7%E5%AE%89%E8%A3%85MySQL/\n版权声明：本博客所有文章除特别声明外，均默认采用 CC BY-NC-SA 4.0 许可协议。');
  }
});</script></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2023/02/11/Centos7%E5%AE%89%E8%A3%85SFTP/" rel="prev" title="Centos7安装SFTP"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">Centos7安装SFTP</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/12/14/Mac%E5%8D%B8%E8%BD%BDJava/" rel="next" title="Mac卸载Java"><span class="post-nav-text">Mac卸载Java</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>若您想及时得到回复提醒，建议跳转 GitHub Issues 评论。</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">京ICP备xxxxxxxx号</a></div><div class="copyright"><span>&copy; 2023 </span><span class="with-love" id="animate" title="星无尘的赞助者"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Michael Chan</span></div><div class="live-time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2023-01-01T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} 天 ${passHour} 小时 ${passMinute} 分 ${passSecond} 秒`;
}
blog_live_time();
</script></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="总访客量"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18","12-13"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script></body></html>